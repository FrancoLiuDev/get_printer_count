# GetPrinterCount 使用說明

## 概述
GetPrinterCount 是一個用於批量擷取 HP 印表機使用統計資料的工具。支援多種 HP 印表機型號，能夠自動從印表機的 LEDM (Lightweight Embedded Device Management) 介面獲取印量資訊。

## 功能特色
- 🖨️ 支援多種 HP 印表機型號
- 📊 批量擷取印表機使用統計
- 📁 支援 Excel 輸入檔案
- 💾 輸出 CSV 格式報表
- 🔍 內建除錯模式
- 🚀 單一執行檔，無需安裝 Python 環境

## 系統需求
- Windows 10/11
- 網路連線能力（需能存取目標印表機）

## 檔案說明
- `GetPrinterCount.exe` - 主程式執行檔
- `printers.xlsx` - 印表機清單範例檔案
- `使用說明.md` - 本說明文件

## 準備工作

### 1. 準備印表機清單 Excel 檔案
建立一個 Excel 檔案（建議命名為 `printers.xlsx`），包含以下欄位：

| 欄位名稱 | 必填 | 說明 | 範例 |
|---------|------|------|------|
| ip | ✅ | 印表機 IP 位址 | 192.168.1.100 |
| model | ✅ | 印表機型號 | M426fdn |
| username | ⭕ | 登入帳號（如需認證） | admin |
| password | ⭕ | 登入密碼（如需認證） | password |

**注意事項：**
- 欄位名稱不區分大小寫
- 也可使用 `host`、`型號`、`機型` 等中文欄位名稱
- 如果印表機不需要認證，可省略 username/password 欄位

### 2. 支援的印表機型號
目前支援以下 HP 印表機系列：
- M225 系列（M225dw）
- M425 系列（M425dn）
- M426 系列（M426fdn）
- CP1525 系列（CP1525, CP1525nw）
- M251 系列（M251nw）
- M254 系列（M254dw）
- M255 系列（M255dw）
- M4103 系列（M4103fdn）

## 使用方法

### 基本用法
```cmd
GetPrinterCount.exe --excel printers.xlsx --out output.csv
```

### 完整參數說明
```cmd
GetPrinterCount.exe [選項]

必要參數：
  --excel EXCEL    指定印表機清單 Excel 檔案路徑

可選參數：
  --out OUT        指定輸出 CSV 檔案路徑（預設：hp_usage_output.csv）
  --debug          啟用除錯模式，顯示詳細執行資訊
  -h, --help       顯示說明訊息
```

### 使用範例

#### 1. 基本使用
```cmd
GetPrinterCount.exe --excel printers.xlsx --out report.csv
```

#### 2. 啟用除錯模式
```cmd
GetPrinterCount.exe --excel printers.xlsx --out report.csv --debug
```

#### 3. 使用預設輸出檔名
```cmd
GetPrinterCount.exe --excel printers.xlsx
```
> 將輸出至 `hp_usage_output.csv`

## 輸出報表說明

程式執行完成後，會產生一個 CSV 報表檔案，包含以下欄位：

| 欄位名稱 | 說明 |
|---------|------|
| host | 印表機 IP 位址 |
| model | 印表機型號 |
| parser_used | 使用的解析器 |
| printer_total_impressions | 總列印數 |
| copy_total_impressions | 總影印數 |
| fax_total_impressions | 總傳真數 |
| mono_impressions | 黑白列印數 |
| color_impressions | 彩色列印數 |
| pcl6_total_impressions | PCL6 總列印數 |
| status | 擷取狀態 |

### 狀態說明
- `ok` - 成功擷取資料
- `error: [錯誤訊息]` - 擷取失敗，顯示錯誤原因

## 故障排除

### 常見問題

#### 1. 連線失敗
**錯誤訊息：** `Connection timeout` 或 `Connection refused`
**解決方法：**
- 檢查印表機 IP 位址是否正確
- 確認印表機已開機且連接網路
- 檢查防火牆設定
- 嘗試 ping 印表機 IP

#### 2. 認證失敗
**錯誤訊息：** `401 Unauthorized`
**解決方法：**
- 在 Excel 檔案中添加正確的 username 和 password
- 檢查印表機 EWS 設定

#### 3. 不支援的印表機型號
**錯誤訊息：** `Unsupported model` 或無資料輸出
**解決方法：**
- 確認印表機型號是否在支援清單中
- 檢查印表機是否支援 LEDM 介面
- 嘗試手動存取 `http://[印表機IP]/DevMgmt/ProductUsageDyn.xml`

#### 4. Excel 檔案格式錯誤
**錯誤訊息：** `File not found` 或 `Invalid format`
**解決方法：**
- 確認檔案路徑正確
- 檢查 Excel 檔案格式（必須是 .xlsx）
- 確認必要欄位（ip, model）存在

### 除錯模式
使用 `--debug` 參數可以看到詳細的執行過程：
```cmd
GetPrinterCount.exe --excel printers.xlsx --out report.csv --debug
```

除錯輸出範例：
```
[DEBUG] 200 text/xml; charset=utf-8 http://192.168.1.100/DevMgmt/ProductUsageDyn.xml
[DEBUG] wrote report.csv with 5 rows
```

## 技術支援

### 聯絡資訊
如遇問題或需要技術支援，請提供：
1. 錯誤訊息截圖
2. 使用的 Excel 檔案格式
3. 印表機型號和 IP 位址
4. 除錯模式輸出結果

### 版本資訊
- 版本：1.0
- 建置日期：2025-12-09
- 相容性：Windows 10/11

---

**注意：** 本工具僅適用於 HP 印表機，其他品牌印表機不支援。使用前請確保有適當的網路存取權限。